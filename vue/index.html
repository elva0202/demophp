<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        table {
            border-color: blue;
        }

        th {
            letter-spacing: 2px;
            text-align: left;
            background-color: #fffacd;
        }
    </style>
</head>

<body>
    <!-- 添加 #app 元素，讓 Vue 能正確掛載 -->
    <div id="app">

        <label>主/客隊:</label>
        <input type="text" v-model="teamfilter" required placeholder="輸入隊名關鍵字">
        <!-- <button class="filter-button-team">查詢隊名</button> -->

        <label>賠率:</label>
        <input type="number" v-model="oddsfilter" required placeholder="輸入賠率" step="0.01">
        <button @click="filterbutton">查詢</button>

        <button @click="buttonOneClick">按鈕 API</button>
        <button @click="loadMatches">按鈕 ajax</button>

        <table v-if="matches.length > 0" border="1" cellpadding="10" cellspacing="0">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>比賽ID</th>
                    <th>賽事編號</th>
                    <th>比賽</th>
                    <th>開始時間</th>
                    <th>客隊</th>
                    <th>主隊</th>
                    <th>負賠率</th>
                    <th>贏賠率</th>
                    <th>數據來源</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="match in matches" :key="match.id">
                    <td>{{ match.id }}</td>
                    <td>{{ match.eventid }}</td>
                    <td>{{ match.number }}</td>
                    <td>{{ match.event }}</td>
                    <td>{{ match.gametime }}</td>
                    <td>{{ match.away_team }}</td>
                    <td>{{ match.home_team }}</td>
                    <td>{{ match.negative_odds }}</td>
                    <td>{{ match.winning_odds }}</td>
                    <td>{{ match.data_sources }}</td>
                </tr>
            </tbody>
        </table>

        <p v-if="matches.length === 0 && dataLoaded">沒有可顯示的比賽數據。</p>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    matches: [],
                    teamfilter: '',
                    oddsfilter: 0,

                };
            },
            methods: {
                filterbutton() {
                    var minOdds = this.oddsfilter
                    var teamkeyword = this.teamfilter

                    if (isNaN(minOdds)) {
                        minOdds = 0;
                    }
                    this.loadMatches(minOdds, teamkeyword);
                },
                async buttonOneClick() {
                    try {
                        const response = await fetch('http://127.0.0.1:8080/demophp/api/fechlist.php');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const data = await response.json();
                        this.matches = data;
                    } catch (error) {
                        console.error('API 請求失敗:', error);
                    }
                },
                loadMatches(minOdds, teamkeyword) {
                    try {
                        $.ajax({
                            url: '../sql/select.php',
                            type: 'POST',
                            data: {
                                table: 'new_table',
                                minOdds: minOdds,
                                teamkeyword: teamkeyword
                            },
                            success: (data) => {
                                if (Array.isArray(data)) {
                                    this.matches = data;
                                } else {
                                    console.error('返回的數據格式不正確', data);
                                }
                            },
                            error: (xhr, status, error) => {
                                console.error('AJAX 請求失敗:', status, error);
                            }
                        });
                    } catch (error) {
                        console.error('請求失敗:', error);
                    }
                }
            }
        });

        app.mount('#app');
    </script>
</body>

</html>